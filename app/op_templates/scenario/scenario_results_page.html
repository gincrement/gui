{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% load custom_template_tags %}
{% load i18n %}

{% block head_block %}
{% endblock head_block %}

{% block start_body_scripts %}
{% endblock start_body_scripts %}

{% block title %}{% translate "Results" %}{% endblock title %}

{% block content %}
<main>
    <section class="header">
        <div>
            <div class="header__left"></div>
            <h1 class="header__title">{% translate "Simulation results" %}</h1>
            <div class="header__back">
                <a href="{% url 'project_search' %}">{% translate "My projects" %}</a>
            </div>
        </div>
    </section>
    <section class="header-results">
        <div>
            <div class="header-results__scenario">
                <div class="project-title">
                    {% translate "Project" %}
                </div>
                <div class="project-name">
                    <form action="{% url 'scenario_visualize_results' %}" method="POST">
                        {% csrf_token %}
                        <select name="proj_id" class="form-select" aria-label="Default select example" onchange="this.form.submit()">
                        {% for project in project_list %}
                            <option value="{{ project.id }}" {% if forloop.counter == proj_id %} selected {% endif %}> {{ project.name }}  </option>
                        {% endfor %}
                        </select>
                    </form>
                </div>
            </div>
            <div class="header-results__export">
                <button class="btn btn--small" type="submit">
                    <span class="icon icon-export"></span>
                    {% translate "Export results" %}
                </button>
            </div>
        </div>
    </section>
    <section class="dashboard">
        <div>
            <div class="row">
                <div class="dashboard__scenarios">
                    <h2>My scenarios</h2>
                    <div class="scenario-select">
                        {% for scenario in scenario_list %}
                        {% if scenario.id|stringformat:'s' in request.session.selected_scenarios %}
                            {% setvar "selected" as selected %}
                        {% else%}
                            {% setvar "" as selected %}
                        {% endif %}
                            <button id="scenario-{{ proj_id }}-{{ scenario.id}}" class="scenario-select__item {{ selected }}" onclick="update_selected_scenarios(this)">
                                {{ scenario.name }}
                            </button>
                        {% endfor %}

                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col col-md-8">
                    <div class="chart">
                        <div class="chart__header">
                            <div>
                                <span class="title">KPI Comparison</span>
                                <span class="view" data-bs-toggle="modal" data-bs-target="#KPIModal">
                      <span class="icon icon-i_arrow_right"></span>
                      View KPIs
                    </span>
                            </div>
                            <div class="dropdown">
                                <button class="btn dropdown-toggle btn--transparent" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                    <span class="icon icon-more"></span>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                    <li><a class="dropdown-item" href="{% url 'not_implemented' %}?url={{ request.get_full_path }}">Export as .xls</a></li>
                                    <li><a class="dropdown-item" href="{% url 'not_implemented' %}?url={{ request.get_full_path }}">Export as PDF</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="chart__plot">
                            <div id="tester"></div>
                        </div>
                    </div>
                </div>
                <div class="col col-md-4">
                    <div class="chart chart--small">
                        <div class="chart__header">
                            <div>
                                <span class="title">Emission Costs</span>
                            </div>
                            <div class="dropdown">
                                <button class="btn dropdown-toggle btn--transparent" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                    <span class="icon icon-more"></span>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                    <li><a class="dropdown-item" href="{% url 'not_implemented' %}?url={{ request.get_full_path }}">Export as .xls</a></li>
                                    <li><a class="dropdown-item" href="{% url 'not_implemented' %}?url={{ request.get_full_path }}">Export as PDF</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="chart__content">
                            <div class="item item--best">
                                <div class="item__name">
                                    Scenario name 5
                                </div>
                                <div class="item__value">
                                    500.000 EUR
                                </div>
                            </div>
                            <div class="item item--worst">
                                <div class="item__name">
                                    Scenario name 10
                                </div>
                                <div class="item__value">
                                    1.000.000 EUR
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chart chart--small">
                        <div class="chart__header">
                            <div>
                                <span class="title">Investment Costs</span>
                            </div>
                            <div class="dropdown">
                                <button class="btn dropdown-toggle btn--transparent" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
                                    <span class="icon icon-more"></span>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
                                    <li><a class="dropdown-item" href="{% url 'not_implemented' %}?url={{ request.get_full_path }}">Export as .xls</a></li>
                                    <li><a class="dropdown-item" href="{% url 'not_implemented' %}?url={{ request.get_full_path }}">Export as PDF</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="chart__content">
                            <div class="item item--best">
                                <div class="item__name">
                                    Scenario name 5
                                </div>
                                <div class="item__value">
                                    500.000 EUR
                                </div>
                            </div>
                            <div class="item item--worst">
                                <div class="item__name">
                                    Scenario name 10
                                </div>
                                <div class="item__value">
                                    1.000.000 EUR
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chart chart--small">
                        <div class="chart__header">
                            <div>
                                <span class="title">Emission Costs</span>
                            </div>
                            <div class="dropdown">
                                <button class="btn dropdown-toggle btn--transparent" type="button" id="dropdownMenuButton3" data-bs-toggle="dropdown" aria-expanded="false">
                                    <span class="icon icon-more"></span>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton3">
                                    <li><a class="dropdown-item" href="{% url 'not_implemented' %}?url={{ request.get_full_path }}">Export as .xls</a></li>
                                    <li><a class="dropdown-item" href="{% url 'not_implemented' %}?url={{ request.get_full_path }}">Export as PDF</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="chart__content">
                            <div class="item item--best">
                                <div class="item__name">
                                    Scenario name 5
                                </div>
                                <div class="item__value">
                                    500.000 EUR
                                </div>
                            </div>
                            <div class="item item--worst">
                                <div class="item__name">
                                    Scenario name 10
                                </div>
                                <div class="item__value">
                                    1.000.000 EUR
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="chart">
                        <div class="chart__header">
                            <div>
                                <span class="title">Time series</span>
                            </div>
                            <div class="dropdown">
                                <button class="btn dropdown-toggle btn--transparent" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                    <span class="icon icon-more"></span>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                    <li><a class="dropdown-item" href="{% url 'not_implemented' %}?url={{ request.get_full_path }}">Export as .xls</a></li>
                                    <li><a class="dropdown-item" href="{% url 'not_implemented' %}?url={{ request.get_full_path }}">Export as PDF</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="chart__plot">
                            <div id="tester2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
{% endblock content %}


{% block end_body_scripts %}

<script>
function update_selected_scenarios(target){
    console.log(target);
    const proj_id = target.id.split("-")[1];

    const scen_id = target.id.split("-")[2];

    // TODO send an ajax request and in the view update the db object which remembers which scenarios were selected for the given project
    // then provide the data in the session so that one does not need to always transfer a ton of data
    // structure should call the list and the success should then call other function which collect the data in the session's cache and plot it(session cache should use mvs tokens to know if a simulation was updated or not)
    console.log(scen_id);
}


</script>
{% endblock end_body_scripts %}
